{% set form_suffix = config.id or 'new' %}
<form id="sync-config-form-{{ form_suffix }}" hx-post="/filesync/config" hx-target="#sync-card-{{ config.id }}"
    hx-swap="outerHTML" class="space-y-4"
    hx-on:htmx:after-request="if (window.Toast?.info) { Toast.info('설정이 저장되었습니다.', { position: 'top-center', duration: 3000 }); }"
    x-data="{ retentionMode: '{{ config.retention_mode }}' }">
    <input id="config-id-{{ form_suffix }}" type="hidden" name="id" value="{{ config.id }}">
    <input id="config-interval-{{ form_suffix }}" type="hidden" name="interval" value="{{ config.interval or 0 }}">
    <div id="config-name-pattern-{{ form_suffix }}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
            <label for="config-name-{{ form_suffix }}" class="block text-sm font-medium text-gray-700">Config Name</label>
            <input id="config-name-{{ form_suffix }}" type="text" name="name" value="{{ config.name }}"
                class="mt-1 block w-full border rounded px-3 py-2">
        </div>
        <div>
            <label for="pattern-{{ form_suffix }}" class="block text-sm font-medium text-gray-700">Pattern (쉼표로 구분)</label>
            <input id="pattern-{{ form_suffix }}" type="text" name="pattern" value="{{ config.pattern }}"
                placeholder="예: *.bak,*.zip"
                class="mt-1 block w-full border rounded px-3 py-2">
        </div>
    </div>

    <div>
        <label for="source-path-{{ form_suffix }}" class="block text-sm font-medium text-gray-700">Source Path</label>
        <input id="source-path-{{ form_suffix }}" type="text" name="source_path" value="{{ config.source_path }}" placeholder="예: /Users/user/Documents"
            class="mt-1 block w-full border rounded px-3 py-2" required>
    </div>

    <div>
        <label for="replica-path-{{ form_suffix }}" class="block text-sm font-medium text-gray-700">Replica Path</label>
        <input id="replica-path-{{ form_suffix }}" type="text" name="replica_path" value="{{ config.replica_path }}"
            placeholder="예: /Users/user/Documents_backup" class="mt-1 block w-full border rounded px-3 py-2" required>
    </div>

    <div id="schedule-retention-row-{{ form_suffix }}" class="grid grid-cols-1 lg:grid-cols-3 gap-4 items-start">
        <div class="lg:col-span-1">
            <label for="retention-mode-{{ form_suffix }}" class="block text-sm font-medium text-gray-700">Retention Mode</label>
            <select id="retention-mode-{{ form_suffix }}" name="retention_mode"
                class="mt-1 block w-full border rounded px-3 py-2" x-model="retentionMode">
                <option value="days">기간(일)</option>
                <option value="count">파일 개수</option>
            </select>
            <p class="mt-1 text-xs text-gray-500">보존 기준을 선택하세요.</p>
        </div>
        <div class="lg:col-span-2">
            <label class="block text-sm font-medium text-gray-700">Retention Value</label>
            <template x-if="retentionMode !== 'count'">
                <div id="retention-days-wrapper-{{ form_suffix }}">
                    <input id="retention-days-{{ form_suffix }}" type="number" name="retention_days" value="{{ config.retention_days }}"
                        class="mt-1 block w-full border rounded px-3 py-2" min="0"
                        :disabled="retentionMode === 'count'">
                    <p class="mt-1 text-xs text-gray-500">기간 기반 보존 시 일수를 입력하세요.</p>
                </div>
            </template>
            <template x-if="retentionMode === 'count'">
                <div id="retention-files-wrapper-{{ form_suffix }}">
                    <input id="retention-files-{{ form_suffix }}" type="number" name="retention_files" value="{{ config.retention_files }}"
                        class="mt-1 block w-full border rounded px-3 py-2" min="0"
                        :disabled="retentionMode !== 'count'">
                    <p class="mt-1 text-xs text-gray-500">파일 개수 모드일 때 유지할 최대 파일 수입니다.</p>
                </div>
            </template>
        </div>
    </div>

    <div class="pt-4 flex gap-4">
        <button id="save-config-{{ form_suffix }}" type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded flex-1">
            Save Configuration
        </button>
    </div>

    {% if message %}
    <div id="config-message-{{ form_suffix }}" class="mt-4 p-3 bg-green-100 text-green-700 rounded text-center">
        {{ message }}
    </div>
    {% endif %}
</form>
